<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Puzzzle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <link href="jquery-ui.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <script src="jquery.js"></script>
  <script src="jquery-ui.js"></script>
  <script src="jquery.ui.touch-punch.js"></script>
</head>
<body>

  <div class="wrapper">
    <div class="container">
      <div class="clip slice1" data-id="1"></div>
      <div class="clip slice2" data-id="2"></div>
      <div class="clip slice3" data-id="3"></div>
      <div class="clip slice4" data-id="4"></div>
    </div>
    <div class="image">
      <div class="target">
        <div class="clip slice1" data-id="1"></div>
        <div class="clip slice2" data-id="2"></div>
        <div class="clip slice3" data-id="3"></div>
        <div class="clip slice4" data-id="4"></div>
      </div>
    </div>
  </div>
  
  <script>
    $('.container .clip').draggable({
      containment: 'window',
      revert: true,
      helper: function() {
        var
          width = $(window).width() - ($(window).width() / 100 * 20) - 40,
          height = $(window).height() - 40;
        
        return $(this).css({
          width: width / 2,
          height: height / 2,
          zIndex: 10000,
          left: -(width / 4)
        })
      }
    });
    
    $('.target').droppable({
      drop: function(event, ui) {
        var
          maxX = 0,
          minX = 100,
          maxY = 0,
          minY = 100,
          id = ui.draggable.data('id'),
          $target = $('.target .clip[data-id="' + id + '"]'),
          width = $target.width(),
          height = $target.height(),
          deltaX = 0, //width / 100 * 20,
          size = ($target.css('-webkit-clip-path') || $target.css('clip-path')).replace('polygon(', '').replace(')', '').split(',');
        
        $.each(size, function(index, item) {
          var xy = $.trim(item).split(' ');
          maxX = Math.max(parseInt(xy[0].replace(/%|px/, '')), maxX);
          maxY = Math.max(parseInt(xy[1].replace(/%|px/, '')), maxY);
          minX = Math.min(parseInt(xy[0].replace(/%|px/, '')), minX);
          minY = Math.min(parseInt(xy[1].replace(/%|px/, '')), minY);
        });
        console.log(ui.position);
        if ((ui.position.left - deltaX > minX / 100 * width) && (ui.position.left - deltaX < maxX / 100 * width) && (ui.position.top > minY / 100 * height) && (ui.position.top < maxY / 100 * height)) {
          ui.draggable.hide();
          $target.show();
        } else {
          setTimeout(function() {
            ui.draggable.css({
              width: '50%',
              height: '25%',
              left: '25%'
            });
          }, 700);
        }
      }
    });
//    $('.clip').draggable({
//      containment: 'window',
//      helper: function() {
//        return $(this).clone().addClass('full-size');
//      }
//    });
//    $('.container, .target').sortable({
//      connectWith: '.connectedSortable'
//    }).disableSelection();
  </script>
</body>
</html>